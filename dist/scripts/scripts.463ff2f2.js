"use strict";angular.module("lifePlannerApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","mgcrea.ngStrap","pascalprecht.translate"]).config(["$routeProvider","$translateProvider",function(a,b){a.when("/",{templateUrl:"views/home.html",controller:"HomeCtrl"}).when("/mission",{templateUrl:"views/mission.html",controller:"MissionCtrl"}).when("/goals",{templateUrl:"views/goal-list.html",controller:"GoalListCtrl"}).when("/goal/:id",{templateUrl:"views/goal-view.html",controller:"GoalViewCtrl"}).when("/activities",{templateUrl:"views/activity-list.html",controller:"ActivityListCtrl"}).otherwise({redirectTo:"/"}),b.translations("en_EN",{menu:{title:"Life Planner",home:"Home",mission:"Mission",goals:"Goals",activities:"Activities"},button:{create:"Create",save:"Save",cancel:"Cancel",edit:"Edit","delete":"Delete"},home:{activitiesThisWeek:{title:"Activities this week"},activitiesThisMonth:{title:"Activities this month"}},mission:{title:"Personal Mission Statement",addRoleButton:"Add new Role",roleModalTitle:"Add new Role",role:{button:{showGoals:"Goals"}}},role:{name:"Name",statement:"Statement"},goal:{list:{title:"Goals",numberOfGoals:"Number of active goals: ",noGoals:"There are no goals yet.",modalTitle:"Create new goal",saveSuccessText:"You have successfully saved the goal!"},name:"Name",description:"Description",imageUrl:"Image Url",priority:"Priority",status:{status:"Status","new":"New",inProgress:"In Progress",done:"Done"},tags:"Tags",date:"Date to achieve"},activity:{list:{title:"Activities",noActivities:"There are no activities yet."},modal:{title:"Add new activity"},title:"Title",status:{status:"Status","new":"New",done:"Done"},date:"Date to perform"}})}]),angular.module("lifePlannerApp").controller("GoalListCtrl",["$scope","GoalList",function(a,b){a.goals=b.all()}]),angular.module("lifePlannerApp").directive("lpGoalTable",["$location",function(a){return{templateUrl:"views/templates/directive/goal/lp-goal-table.html",restrict:"E",scope:{goals:"=",noGoalsText:"@"},link:function(b){b.viewGoal=function(b){a.path("/goal/"+b.id)},b.removeGoal=function(a){a.remove()}}}}]),angular.module("lifePlannerApp").controller("MainCtrl",["$scope","$translate","$location","GoalDecorator","RoleDecorator","ActivityDecorator",function(a,b,c,d,e,f){b.use("en_EN"),d.decorate(),e.decorate(),f.decorate()}]),angular.module("lifePlannerApp").service("Storage",function(){this.get=function(a,b){return localStorage[a]?JSON.parse(localStorage[a]):b},this.set=function(a,b){localStorage[a]=JSON.stringify(b)}}),angular.module("lifePlannerApp").directive("lpGoalView",["ActivityList",function(a){return{templateUrl:"views/templates/directive/goal/lp-goal-view.html",restrict:"E",link:function(b){b.activities=_.filter(a.all(),function(a){return a.goalId===b.goal.id})}}}]),angular.module("lifePlannerApp").controller("GoalViewCtrl",["$scope","$routeParams","GoalList",function(a,b,c){a.goal=c.get(b.id)}]),angular.module("lifePlannerApp").service("GoalConfig",function(){this.statuses={"new":"new",inProgress:"inProgress",done:"done"},this.priorities=[1,2,3,4,5,6,7,8,9],this.tags=["life","family","sport","career","health","future","personality","product","entertainment","experience","donation","learn","hobby","important","other"].sort()}),angular.module("lifePlannerApp").controller("HomeCtrl",["$scope","DateHelper",function(a,b){var c,d=new Date,e=b.firstDayOfWeek(d),f=b.lastDayOfWeek(d);a.isThisWeek=function(a){return c=b.format(a.date),c>=e&&f>=c},a.isThisMonth=function(a){return d.getFullYear()===a.date.getFullYear()&&d.getMonth()===a.date.getMonth()}}]),angular.module("lifePlannerApp").directive("lpNavLink",["$location",function(a){return{templateUrl:"views/templates/directive/lp-nav-link.html",restrict:"E",replace:!0,scope:{title:"@",path:"@"},link:function(b){b.isActive=function(){return a.$$path===b.path}}}}]),angular.module("lifePlannerApp").service("DateHelper",function(){this.format=function(a){return a.toISOString().slice(0,10)},this.firstDayOfWeek=function(a){var b=a.getDate()-a.getDay();return this.format(new Date(a.setDate(b)))},this.lastDayOfWeek=function(a){var b=a.getDate()-a.getDay()+6;return this.format(new Date(a.setDate(b)))}}),angular.module("lifePlannerApp").controller("MissionCtrl",["$scope","$modal","RoleList",function(a,b,c){a.roles=c.all(),a.role=c.createSkeleton();var d=b({scope:a,templateUrl:"views/templates/modal/lp-role-modal.html",show:!1});a.addRole=function(){c.save(a.role),a.role=c.createSkeleton(),d.hide()},a.showModal=function(){d.$promise.then(d.show)}}]),angular.module("lifePlannerApp").directive("lpRoleRow",["RoleList","GoalList",function(a,b){return{templateUrl:"views/templates/directive/lp-role-row.html",restrict:"E",scope:{role:"="},link:function(c){c.editable=!1,c.showGoals=!1,c.goals=[],_.each(c.role.goals,function(a){c.goals.push(b.get(a))}),c.showForm=function(){c.editable=!0},c.saveRole=function(){c.editable=!1,a.save(c.role)},c.removeRole=function(){a.remove(c.role)}}}}]),angular.module("lifePlannerApp").factory("ListFactory",["Storage",function(a){var b=function(b){var c=a.get(b,{elements:[],nextId:1});this.get=function(a){return a=parseInt(a),_.find(c.elements,function(b){return b.id===a})},this.remove=function(d){_.remove(c.elements,function(a){return a.id===d.id}),a.set(b,c)},this.save=function(d){d.id||(d.id=c.nextId++,c.elements.push(d)),a.set(b,c)},this.all=function(){return c.elements}};return{create:function(a){return new b(a)}}}]),angular.module("lifePlannerApp").factory("RoleList",["ListFactory",function(a){return a.create("LP-Roles")}]),angular.module("lifePlannerApp").factory("GoalList",["ListFactory",function(a){return a.create("LP-Goals")}]),angular.module("lifePlannerApp").factory("ActivityList",["ListFactory",function(a){return a.create("LP-Activities")}]),angular.module("lifePlannerApp").factory("RoleDecorator",["RoleList","GoalList",function(a,b){var c,d={addGoal:function(a){this.hasGoal(a)||this.goals.push(a.id)},hasGoal:function(a){return this.goals.indexOf(a.id)>-1},removeGoal:function(a){_.remove(this.goals,function(b){return b===a.id})},save:function(){a.save(this),_.each(this.goals,function(a){c=b.get(a),c.addRole(this),b.save(c)})},remove:function(){_.each(this.goals,function(a){c=b.get(a),c.removeRole(this),b.save(c)}),a.remove(this)}},e=function(a){_.each(a.all(),function(a){_.extend(a,d)})},f=function(a){a.createSkeleton=function(){var a={name:"",statement:"",goals:[]};return _.extend(a,d),a}};return{decorate:function(){e(a),f(a)}}}]),angular.module("lifePlannerApp").factory("GoalDecorator",["GoalList","RoleList","ActivityList",function(a,b,c){var d,e,f={addRole:function(a){this.hasRole(a)||this.roles.push(a.id)},hasRole:function(a){return this.roles.indexOf(a.id)>-1},removeRole:function(a){_.remove(this.roles,function(b){return b===a.id})},addActivity:function(a){this.hasActivity(a)||this.activities.push(a.id)},hasActivity:function(a){return this.activities.indexOf(a.id)>-1},removeActivity:function(a){_.remove(this.activities,function(b){return b===a.id})},save:function(){var f=this;a.save(f),_.each(f.roles,function(a){d=b.get(a),d.addGoal(f),b.save(d)}),_.each(f.activities,function(a){e=c.get(a),e.setGoal(f),c.save(d)})},remove:function(){var f=this;_.each(f.roles,function(a){d=b.get(a),d.removeGoal(f),b.save(d)}),_.each(f.activities,function(a){e=c.get(a),c.remove(e)}),a.remove(f)}},g=function(a){_.each(a.all(),function(a){_.extend(a,f),a.date=new Date(a.date)})},h=function(a){a.createSkeleton=function(){var a={name:"",description:"",status:"new",image:"",tags:[],priority:1,date:new Date,roles:[],activities:[]};return _.extend(a,f),a}};return{decorate:function(){g(a),h(a)}}}]),angular.module("lifePlannerApp").factory("ActivityDecorator",["ActivityList","GoalList",function(a,b){var c={setGoal:function(a){this.goalId=a.id},getGoal:function(){return b.get(this.goalId)},save:function(){a.save(this),this.getGoal().addActivity(this),this.getGoal().save()},remove:function(){this.getGoal().removeActivity(this),this.getGoal().save(),a.remove(this)}},d=function(a){_.each(a.all(),function(a){_.extend(a,c),a.date=new Date(a.date)})},e=function(a){a.createSkeleton=function(){var a={title:"",status:"new",date:new Date,goalId:0};return _.extend(a,c),a}};return{decorate:function(){d(a),e(a)}}}]),angular.module("lifePlannerApp").factory("Notifier",["$translate",function(a){var b={newest_on_top:!0,delay:3e3,timer:500,allow_dismiss:!0,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}};return{success:function(c){a(c).then(function(a){$.notify(a,_.extend({type:"success"},b))})}}}]),angular.module("lifePlannerApp").controller("ActivityListCtrl",["$scope","ActivityList","GoalList",function(a,b,c){a.goals=_.filter(c.all(),function(a){return a.activities.length>0})}]),angular.module("lifePlannerApp").directive("lpActivityTable",["ActivityList",function(a){return{templateUrl:"views/templates/directive/activity/lp-activity-table.html",restrict:"E",scope:{title:"@",goal:"=?",condition:"=?",enableAdd:"=?"},link:function(b){b.activities=a.all(),b.goal&&void 0===b.condition&&(b.condition=function(a){return b.goal.id===a.goalId}),b.showChecked=!0,b.showUnchecked=!0,b.showActivity=function(a){return"done"===a.status&&b.showChecked||"new"===a.status&&b.showUnchecked},b.changeActivityStatus=function(a){a.status="done"===a.status?"new":"done",a.save()},b.removeActivity=function(a){a.remove()}}}}]),angular.module("lifePlannerApp").directive("lpActivityCreateButton",["$modal","ActivityList","Notifier",function(a,b,c){return{templateUrl:"views/templates/directive/activity/lp-activity-create-button.html",restrict:"E",replace:!0,scope:{goal:"="},link:function(d){d.activity=b.createSkeleton();var e=a({scope:d,templateUrl:"views/templates/modal/lp-activity-modal.html",show:!1});d.statuses={"new":"new",done:"done"},d.addActivity=function(){d.activity.setGoal(d.goal),d.activity.save(),e.hide(),c.success("goal.list.saveSuccessText"),d.activity=b.createSkeleton()},d.showActivityModal=function(){e.$promise.then(e.show).then()}}}}]),angular.module("lifePlannerApp").directive("lpGoalStatusDropdown",["GoalConfig",function(a){return{templateUrl:"views/templates/directive/goal/lp-goal-status-dropdown.html",restrict:"E",scope:{goal:"="},link:function(b){b.statuses=a.statuses,b.changeStatus=function(a){b.goal.status=a,b.goal.save()}}}}]),angular.module("lifePlannerApp").directive("lpGoalPriorityDropdown",["GoalConfig",function(a){return{templateUrl:"views/templates/directive/goal/lp-goal-priority-dropdown.html",restrict:"E",scope:{goal:"="},link:function(b){b.priorities=a.priorities,b.changePriority=function(a){b.goal.priority=a,b.goal.save()}}}}]),angular.module("lifePlannerApp").directive("lpGoalCreateButton",["$modal","GoalConfig","Notifier","GoalList","RoleList",function(a,b,c,d,e){return{templateUrl:"views/templates/directive/goal/lp-goal-create-button.html",restrict:"E",replace:!0,scope:{goals:"="},link:function(f){f.roles=e.all();var g=a({scope:f,templateUrl:"views/templates/modal/lp-goal-modal.html",show:!1});f.goalConfig=b,f.selectPriority=function(a){f.goal.priority=a},f.hasTag=function(a){return _.contains(f.goal.tags,a)},f.toggleTag=function(a){f.hasTag(a)?_.remove(f.goal.tags,function(b){return b===a}):f.goal.tags.push(a)},f.toggleRole=function(a){f.goal.hasRole(a)?f.goal.removeRole(a):f.goal.addRole(a)},f.saveGoal=function(){f.goal.save(),g.hide(),c.success("goal.list.saveSuccessText")},f.showGoalModal=function(a){a?(f.goal=a,f.modalTitle="goal.modal.update_title"):(f.goal=d.createSkeleton(),f.modalTitle="goal.modal.create_title"),g.$promise.then(g.show)}}}}]),angular.module("lifePlannerApp").run(["$templateCache",function(a){a.put("views/activity-list.html",'<div> <div ng-repeat="goal in goals track by $index"> <lp-activity-table title="{{goal.name}}" goal="goal" enable-add="true"></lp-activity-table> </div> </div>'),a.put("views/goal-list.html",'<div> <div> <h2 translate>goal.list.title</h2> </div> <div>{{\'goal.list.numberOfGoals\'|translate}} {{goals.length}}</div> <div class="clearfix"></div> <lp-goal-table goals="goals" no-goals-text="{{\'goal.list.noGoals\'|translate}}"></lp-goal-table> </div>'),a.put("views/goal-view.html","<div> <lp-goal-view></lp-goal-view> </div>"),a.put("views/home.html",'<div> <lp-activity-table title="{{\'home.activitiesThisWeek.title\'|translate}}" condition="isThisWeek"></lp-activity-table> <lp-activity-table title="{{\'home.activitiesThisMonth.title\'|translate}}" condition="isThisMonth"></lp-activity-table> </div>'),a.put("views/mission.html",'<div> <div> <h1 translate>mission.title</h1> </div> <div> <div class="pull-right"> <a class="btn btn-sm btn-success" ng-click="showModal()"> <span class="glyphicon glyphicon-plus"></span> </a> </div> <div class="clearfix"></div> </div> <div class="roles"> <div ng-repeat="role in roles track by $index"> <lp-role-row role="role"></lp-role-row> </div> </div> </div>')}]);